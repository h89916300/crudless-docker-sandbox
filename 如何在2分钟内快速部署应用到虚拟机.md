# 如何在2分钟内快速部署应用到虚拟机

> 文档假定开发需求测试**当前应用的前后端服务**，并快速部署到虚机进行测试或演示
>
> 以下应用名称为  `iot`, 服务器暴露的测试端口为 `8000`, 数据库名称用 `test`进行演示

## 服务端部署
> 用户登录进入虚拟机（服务器）进行部署

### 获取docker部署模板
```shell
$ git clone https://github.com/smallsaas/crudless-docker-sandbox.git  iot
```

### 准备API安装包 
> 在本地 `mvn package` 生成 `iot-1.0.0-standalone.jar`, 并通过`scp`将生成的Jar包上传至服务端相应目录
```shell
$ ls ~/iot/api/iot-1.0.0-standalone.jar
iot-1.0.0-standalone.jar
```

### 准备 web dist
> 在本地 `npm run buil` 生成 `dist`，并通过`scp`将生成的dist上传至服务端相应目录
```shell
$ ls ~/iot/web
dist
```

### 绿地部署

>**目的：绿地部署主要是为了初始化数据库及相应的配置文件，若已初始化则可跳过此步骤。**

```shell
$ sh greenfield.sh
Usage: greenfield.sh <app> <port> <database>
Option:
    app       - app name a.w.a. prefix of docker container name
    port      - expose port from host
    database  - database name

$ sh greenfield.sh iot 8000 test
  ...
  com.jfeat.AmApplication : Test SaaS is success!
```

> Ctrl+C 停掉运行的容器

### 正式部署 
```shell
$ cd ~/iot
$ docker-compose up   ## 可实时查看log
$ # docker-compose up -d  ## 应用后台运行
```
